From fc8077c2debdeb4cead3d0574cec0a53016b6e14 Mon Sep 17 00:00:00 2001
From: Zach Brown <zach.brown@destroystokyo.com>
Date: Sat, 23 Sep 2017 21:00:41 -0400
Subject: [PATCH] Allow nerfed mobs to jump


diff --git a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
index 22999f0..5f13fbf 100644
--- a/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
+++ b/src/main/java/com/destroystokyo/paper/PaperWorldConfig.java
@@ -94,4 +94,9 @@ public class PaperWorldConfig {
         fishingMaxTicks = getInt("fishing-time-range.MaximumTicks", 600);
         log("Fishing time ranges are between " + fishingMinTicks +" and " + fishingMaxTicks + " ticks");
     }
+
+    public boolean nerfedMobsShouldJump;
+    private void nerfedMobsShouldJump() {
+        nerfedMobsShouldJump = getBoolean("spawner-nerfed-mobs-should-jump", false);
+    }
 }
diff --git a/src/main/java/net/minecraft/entity/EntityLiving.java b/src/main/java/net/minecraft/entity/EntityLiving.java
index 87aa3d1..69b1dc9 100644
--- a/src/main/java/net/minecraft/entity/EntityLiving.java
+++ b/src/main/java/net/minecraft/entity/EntityLiving.java
@@ -90,6 +90,7 @@ public abstract class EntityLiving extends EntityLivingBase {
     private boolean isLeashed;
     private Entity leashHolder;
     private NBTTagCompound leashNBTTag;
+    @Nullable public net.minecraft.entity.ai.EntityAISwimming nerfedSwimController; // Paper
 
     public EntityLiving(World worldIn) {
         super(worldIn);
@@ -708,6 +709,13 @@ public abstract class EntityLiving extends EntityLivingBase {
             this.jumpHelper.doJump();
             this.world.profiler.endSection();
             this.world.profiler.endSection();
+        } else {
+            // Paper start - Allow nerfed mobs to jump and float
+            if (nerfedSwimController != null) {
+                if (nerfedSwimController.shouldExecute()) nerfedSwimController.updateTask();
+                this.getJumpHelper().doJump();
+            }
+            // Paper end
         }
     }
 
diff --git a/src/main/java/net/minecraft/entity/ai/EntityAISwimming.java b/src/main/java/net/minecraft/entity/ai/EntityAISwimming.java
index 5560b03..40a04c3 100644
--- a/src/main/java/net/minecraft/entity/ai/EntityAISwimming.java
+++ b/src/main/java/net/minecraft/entity/ai/EntityAISwimming.java
@@ -11,6 +11,12 @@ public class EntityAISwimming extends EntityAIBase {
         this.entity = entityIn;
         this.setMutexBits(4);
 
+        // Paper start - Allow nerfed mobs to swim
+        if (entityIn.fromMobSpawner && entityIn.getEntityWorld().paperConfig.nerfedMobsShouldJump){
+            entityIn.nerfedSwimController = this;
+        }
+        // Paper end
+
         if (entityIn.getNavigator() instanceof PathNavigateGround) {
             ((PathNavigateGround) entityIn.getNavigator()).setCanSwim(true);
         } else if (entityIn.getNavigator() instanceof PathNavigateFlying) {
-- 
2.14.1.windows.1

