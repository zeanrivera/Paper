From c699f609140f260254c34e44c159f2cd2af20a4e Mon Sep 17 00:00:00 2001
From: AlphaBlend <whizkid3000@hotmail.com>
Date: Tue, 10 Oct 2017 16:53:27 -0400
Subject: [PATCH] Add EntityZapEvent


diff --git a/src/main/java/net/minecraft/entity/passive/EntityPig.java b/src/main/java/net/minecraft/entity/passive/EntityPig.java
index 6c24b67..740365a 100644
--- a/src/main/java/net/minecraft/entity/passive/EntityPig.java
+++ b/src/main/java/net/minecraft/entity/passive/EntityPig.java
@@ -187,6 +187,12 @@ public class EntityPig extends EntityAnimal {
         if (!this.world.isRemote && !this.isDead) {
             EntityPigZombie entitypigzombie = new EntityPigZombie(this.world);
 
+            // Paper start
+            if (CraftEventFactory.callEntityZapEvent(this, lightningBolt, entitypigzombie).isCancelled()) {
+                return;
+            }
+            // Paper end
+
             if (CraftEventFactory.callPigZapEvent(this, lightningBolt, entitypigzombie).isCancelled()) {
                 return;
             }
diff --git a/src/main/java/net/minecraft/entity/passive/EntityVillager.java b/src/main/java/net/minecraft/entity/passive/EntityVillager.java
index 8da9289..5bce765 100644
--- a/src/main/java/net/minecraft/entity/passive/EntityVillager.java
+++ b/src/main/java/net/minecraft/entity/passive/EntityVillager.java
@@ -909,6 +909,13 @@ public class EntityVillager extends EntityAgeable implements INpc, IMerchant {
     public void onStruckByLightning(EntityLightningBolt lightningBolt) {
         if (!this.world.isRemote && !this.isDead) {
             EntityWitch entitywitch = new EntityWitch(this.world);
+
+            // Paper start
+            if (org.bukkit.craftbukkit.event.CraftEventFactory.callEntityZapEvent(this, lightningBolt, entitywitch).isCancelled()) {
+                return;
+            }
+            // Paper end
+
             entitywitch.setLocationAndAngles(this.posX, this.posY, this.posZ, this.rotationYaw, this.rotationPitch);
             entitywitch.onInitialSpawn(this.world.getDifficultyForLocation(new BlockPos(entitywitch)), (IEntityLivingData) null);
             entitywitch.setNoAI(this.isAIDisabled());
@@ -918,7 +925,7 @@ public class EntityVillager extends EntityAgeable implements INpc, IMerchant {
                 entitywitch.setAlwaysRenderNameTag(this.getAlwaysRenderNameTag());
             }
 
-            this.world.spawnEntity(entitywitch);
+            this.world.addEntity(entitywitch, org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason.LIGHTNING); // Paper - Added lightning spawn reason for this entity
             this.setDead();
         }
     }
diff --git a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
index ae4861d..4d555d3 100644
--- a/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
+++ b/src/main/java/org/bukkit/craftbukkit/event/CraftEventFactory.java
@@ -838,6 +838,14 @@ public class CraftEventFactory {
         return event;
     }
 
+    // Paper start
+    public static com.destroystokyo.paper.event.entity.EntityZapEvent callEntityZapEvent (Entity entity, Entity lightning, Entity changedEntity) {
+        com.destroystokyo.paper.event.entity.EntityZapEvent event = new com.destroystokyo.paper.event.entity.EntityZapEvent(entity.getBukkitEntity(), (LightningStrike) lightning.getBukkitEntity(), changedEntity.getBukkitEntity());
+        entity.getBukkitEntity().getServer().getPluginManager().callEvent(event);
+        return event;
+    }
+    // Paper end
+
     public static HorseJumpEvent callHorseJumpEvent(Entity horse, float power) {
         HorseJumpEvent event = new HorseJumpEvent((AbstractHorse) horse.getBukkitEntity(), power);
         horse.getBukkitEntity().getServer().getPluginManager().callEvent(event);
-- 
2.14.3

